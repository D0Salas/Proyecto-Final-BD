package mcgo;

// LoginDialog.java
import javax.swing.*;
import java.awt.*;
import java.sql.Connection;
import java.sql.DriverManager;

public class LoginDialog extends JDialog {
    private boolean connected = false;
    private Connection connection;
    
    private JTextField userField;
    private JPasswordField passwordField;
    
    public LoginDialog(Frame parent) {
        super(parent, "Login Base de Datos", true);
        initializeUI();
    }
    
    private void initializeUI() {
        setLayout(new GridLayout(3, 2));
        
        add(new JLabel("Usuario MySQL:"));
        userField = new JTextField("root");
        add(userField);
        
        add(new JLabel("Contraseña:"));
        passwordField = new JPasswordField();
        add(passwordField);
        
        JButton connectBtn = new JButton("Conectar");
        JButton cancelBtn = new JButton("Cancelar");
        
        add(connectBtn);
        add(cancelBtn);
        
        connectBtn.addActionListener(e -> connectToDatabase());
        cancelBtn.addActionListener(e -> System.exit(0));
        
        setSize(300, 150);
        setLocationRelativeTo(null);
        setDefaultCloseOperation(DISPOSE_ON_CLOSE);
    }
    
    private void connectToDatabase() {
        String user = userField.getText();
        String password = new String(passwordField.getPassword());
        
        try {
            Class.forName("com.mysql.cj.jdbc.Driver");
            Connection conn = DriverManager.getConnection(
                "jdbc:mysql://localhost:3306/McGo", user, password);
            
            this.connection = conn;
            this.connected = true;
            
            // Guardar las credenciales para uso posterior
            DatabaseConnection.setCredentials(user, password);
            
            JOptionPane.showMessageDialog(this, "Conexión exitosa!");
            dispose();
            
        } catch (Exception e) {
            JOptionPane.showMessageDialog(this, 
                "Error de conexión: " + e.getMessage(), 
                "Error", JOptionPane.ERROR_MESSAGE);
        }
    }
    
    public boolean isConnected() { return connected; }
    public Connection getConnection() { return connection; }
}
